<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PiP API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        video {
            width: 100%;
            max-width: 500px;
            border-radius: 8px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¥ Picture-in-Picture API ãƒ†ã‚¹ãƒˆ</h1>
        
        <h2>ãƒ†ã‚¹ãƒˆãƒ“ãƒ‡ã‚ª</h2>
        <video id="testVideo" controls>
            <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
            <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«é…ç½®ã—ã¦ãã ã•ã„
        </video>
        
        <div style="margin-top: 15px;">
            <button onclick="testPiPSupport()">ğŸ“‹ PiP ã‚µãƒãƒ¼ãƒˆç¢ºèª</button>
            <button onclick="requestPiP()">ğŸ“º PiP é–‹å§‹</button>
            <button onclick="exitPiP()">âŒ PiP çµ‚äº†</button>
            <button onclick="testVideoState()">ğŸ” ãƒ“ãƒ‡ã‚ªçŠ¶æ…‹ç¢ºèª</button>
            <button onclick="clearLog()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div id="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testPiPSupport() {
            log('=== PiP ã‚µãƒãƒ¼ãƒˆç¢ºèªé–‹å§‹ ===');
            
            // åŸºæœ¬çš„ãªAPIãƒã‚§ãƒƒã‚¯
            if ('pictureInPictureEnabled' in document) {
                log('âœ… document.pictureInPictureEnabled: ' + document.pictureInPictureEnabled);
            } else {
                log('âŒ document.pictureInPictureEnabled ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
            
            // ãƒ“ãƒ‡ã‚ªè¦ç´ ã®PiPã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
            const video = document.getElementById('testVideo');
            if (video) {
                log('âœ… ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                
                if ('requestPictureInPicture' in video) {
                    log('âœ… video.requestPictureInPicture ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨å¯èƒ½');
                } else {
                    log('âŒ video.requestPictureInPicture ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                if ('disablePictureInPicture' in video) {
                    log(`ğŸ“Œ video.disablePictureInPicture: ${video.disablePictureInPicture}`);
                } else {
                    log('âŒ video.disablePictureInPicture ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                log(`ğŸ“Œ ãƒ“ãƒ‡ã‚ªã®å†ç”ŸçŠ¶æ…‹: paused=${video.paused}, currentTime=${video.currentTime}`);
                log(`ğŸ“Œ ãƒ“ãƒ‡ã‚ªã®æº–å‚™çŠ¶æ…‹: readyState=${video.readyState}, networkState=${video.networkState}`);
            } else {
                log('âŒ ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ç¾åœ¨ã®PiPçŠ¶æ…‹
            if ('pictureInPictureElement' in document) {
                log(`ğŸ“Œ ç¾åœ¨ã®PiPè¦ç´ : ${document.pictureInPictureElement ? 'ã‚ã‚Š' : 'ãªã—'}`);
            }
            
            log('=== PiP ã‚µãƒãƒ¼ãƒˆç¢ºèªå®Œäº† ===');
        }

        async function requestPiP() {
            log('=== PiP é–‹å§‹è©¦è¡Œ ===');
            
            const video = document.getElementById('testVideo');
            if (!video) {
                log('âŒ ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                log('ğŸ”„ PiP ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹...');
                
                // ã¾ãšå‹•ç”»ã‚’å†ç”Ÿ
                if (video.paused) {
                    log('â–¶ï¸ ãƒ“ãƒ‡ã‚ªã‚’å†ç”Ÿé–‹å§‹');
                    await video.play();
                }
                
                // PiPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                const pipWindow = await video.requestPictureInPicture();
                log('âœ… PiP ãƒ¢ãƒ¼ãƒ‰é–‹å§‹æˆåŠŸï¼');
                log(`ğŸ“º PiP ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º: ${pipWindow.width}x${pipWindow.height}`);
                
                pipWindow.addEventListener('resize', () => {
                    log(`ğŸ“ PiP ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´: ${pipWindow.width}x${pipWindow.height}`);
                });
                
            } catch (error) {
                log(`âŒ PiP é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.name} - ${error.message}`);
                
                if (error.name === 'NotSupportedError') {
                    log('ğŸ’¡ ã“ã®ç’°å¢ƒã§ã¯PiPãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                } else if (error.name === 'NotAllowedError') {
                    log('ğŸ’¡ PiPä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ï¼‰');
                } else if (error.name === 'InvalidStateError') {
                    log('ğŸ’¡ ãƒ“ãƒ‡ã‚ªã®çŠ¶æ…‹ãŒç„¡åŠ¹ã§ã™');
                }
            }
        }

        async function exitPiP() {
            log('=== PiP çµ‚äº†è©¦è¡Œ ===');
            
            try {
                if (document.pictureInPictureElement) {
                    await document.exitPictureInPicture();
                    log('âœ… PiP ãƒ¢ãƒ¼ãƒ‰çµ‚äº†æˆåŠŸ');
                } else {
                    log('â„¹ï¸ ç¾åœ¨PiPãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                log(`âŒ PiP çµ‚äº†ã‚¨ãƒ©ãƒ¼: ${error.name} - ${error.message}`);
            }
        }

        function testVideoState() {
            log('=== ãƒ“ãƒ‡ã‚ªçŠ¶æ…‹ç¢ºèª ===');
            
            const video = document.getElementById('testVideo');
            if (!video) {
                log('âŒ ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            log(`ğŸ“Œ paused: ${video.paused}`);
            log(`ğŸ“Œ currentTime: ${video.currentTime}`);
            log(`ğŸ“Œ duration: ${video.duration}`);
            log(`ğŸ“Œ readyState: ${video.readyState}`);
            log(`ğŸ“Œ networkState: ${video.networkState}`);
            log(`ğŸ“Œ videoWidth: ${video.videoWidth}`);
            log(`ğŸ“Œ videoHeight: ${video.videoHeight}`);
            log(`ğŸ“Œ disablePictureInPicture: ${video.disablePictureInPicture}`);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            log('ğŸš€ PiP ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            testPiPSupport();
        });

        // PiPã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('enterpictureinpicture', (event) => {
            log('ğŸ‰ PiP ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ');
        });

        document.addEventListener('leavepictureinpicture', (event) => {
            log('ğŸ‘‹ PiP ãƒ¢ãƒ¼ãƒ‰çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ');
        });
    </script>
</body>
</html>
