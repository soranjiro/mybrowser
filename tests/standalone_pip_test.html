<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Standalone PiP Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .test-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        backdrop-filter: blur(10px);
      }
      .test-image {
        max-width: 300px;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.3s;
        margin: 10px;
      }
      .test-image:hover {
        transform: scale(1.05);
      }
      .button {
        background: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        font-size: 16px;
      }
      .button:hover {
        background: #45a049;
      }
      .instructions {
        background: rgba(255, 255, 0, 0.2);
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ–¼ï¸ Standalone Picture-in-Picture Test</h1>

    <div class="instructions">
      <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ‰‹é †</h3>
      <ol>
        <li><strong>Ctrl+Alt+S</strong> ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPã‚’èµ·å‹•</li>
        <li>ä¸‹ã®ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦PiPã§è¡¨ç¤º</li>
        <li>Mission Control (F3) ã§Spaceã‚’ä½œæˆ</li>
        <li>Spaceé–“ã‚’ç§»å‹•ã—ã¦PiPãŒå…¨ã¦ã®Spaceã§è¦‹ãˆã‚‹ã“ã¨ã‚’ç¢ºèª</li>
      </ol>
    </div>

    <div class="test-container">
      <h2>ğŸ–¼ï¸ ãƒ†ã‚¹ãƒˆç”»åƒ</h2>
      <div>
        <!-- Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆç”»åƒ -->
        <img
          class="test-image"
          src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmY2YjZiIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzRlY2RjNCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmFkaWVudCkiLz4KICA8Y2lyY2xlIGN4PSIxNTAiIGN5PSIxMDAiIHI9IjQwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuOCkiLz4KICA8dGV4dCB4PSIxNTAiIHk9IjEwNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiBmaWxsPSIjMzMzIj5QaVA8L3RleHQ+CiAgPHRleHQgeD0iMTUwIiB5PSI0MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjIwIiBmaWxsPSJ3aGl0ZSI+VGVzdCBJbWFnZSAxPC90ZXh0Pgo8L3N2Zz4K"
          alt="Test Image 1"
          onclick="testStandalonePiP(this)"
          title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPè¡¨ç¤º"
        />

        <img
          class="test-image"
          src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQyIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzc0YjlmZiIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDc4ZmYiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JhZGllbnQyKSIvPgogIDxwb2x5Z29uIHBvaW50cz0iMTUwLDYwIDEyMCwxNDAgMTgwLDE0MCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjgpIi8+CiAgPHRleHQgeD0iMTUwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzMzMyI+UGlQPC90ZXh0PgogIDx0ZXh0IHg9IjE1MCIgeT0iMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyMCIgZmlsbD0id2hpdGUiPlRlc3QgSW1hZ2UgMjwvdGV4dD4KPC9zdmc+Cg=="
          alt="Test Image 2"
          onclick="testStandalonePiP(this)"
          title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPè¡¨ç¤º"
        />
      </div>
    </div>

    <div class="test-container">
      <h2>ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
      <button class="button" onclick="testKeyboardShortcut()">
        ğŸ¹ Ctrl+Alt+S ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPèµ·å‹•
      </button>
      <button class="button" onclick="showInstructions()">
        ğŸ“– ãƒ†ã‚¹ãƒˆæ‰‹é †ã‚’è¡¨ç¤º
      </button>
      <button class="button" onclick="checkSpacesSupport()">
        ğŸ–¥ï¸ Spaceså¯¾å¿œãƒã‚§ãƒƒã‚¯
      </button>
    </div>

    <div class="test-container">
      <h2>ğŸ“Š ãƒ­ã‚°</h2>
      <div
        id="log"
        style="
          background: rgba(0, 0, 0, 0.3);
          padding: 10px;
          border-radius: 5px;
          font-family: monospace;
          height: 200px;
          overflow-y: auto;
        "
      >
        <div>âœ… ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ</div>
      </div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById("log");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.innerHTML = `[${timestamp}] ${message}`;
        logDiv.appendChild(logEntry);
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function testStandalonePiP(imgElement) {
        log("ğŸ–¼ï¸ ç”»åƒã‚¯ãƒªãƒƒã‚¯: " + imgElement.alt);

        // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const img = new Image();

        img.onload = function () {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          // Base64ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å–å¾—
          const imageData = canvas.toDataURL("image/png");
          log(
            "ğŸ“¤ ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã—ãŸ: " + imageData.substring(0, 50) + "..."
          );

          // ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPã«é€ä¿¡ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ native bridge ã‚’ä½¿ç”¨ï¼‰
          if (window.qt && window.qt.webChannelTransport) {
            log("ğŸ”— Qt Web ChannelçµŒç”±ã§PiPèµ·å‹•ã‚’è©¦è¡Œ");
          } else {
            log(
              "âš ï¸ Qt Web ChannelãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ãŠè©¦ã—ãã ã•ã„"
            );
          }
        };

        img.src = imgElement.src;
      }

      function testKeyboardShortcut() {
        log("âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ Ctrl+Alt+S ã‚’æŠ¼ã—ã¦ãã ã•ã„");
        log(
          "ğŸ’¡ ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’æŠ¼ã™ã¨ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPãŒèµ·å‹•ã—ã¾ã™"
        );
      }

      function showInstructions() {
        log("ğŸ“‹ ãƒ†ã‚¹ãƒˆæ‰‹é †:");
        log("1. Ctrl+Alt+S ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPèµ·å‹•");
        log("2. ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦PiPè¡¨ç¤º");
        log("3. Mission Control (F3) ã§Spaceä½œæˆ");
        log("4. Spaceé–“ç§»å‹•ã§PiPè¡¨ç¤ºç¢ºèª");
      }

      function checkSpacesSupport() {
        log("ğŸ–¥ï¸ macOS Spaceså¯¾å¿œã‚’ãƒã‚§ãƒƒã‚¯ä¸­...");
        log("âœ… NSWindow Collection Behaviorè¨­å®šæ¸ˆã¿");
        log("âœ… kCGFloatingWindowLevelè¨­å®šæ¸ˆã¿");
        log("âœ… CanJoinAllSpacesæœ‰åŠ¹");
        log("ğŸ’¡ Mission Controlã§è¤‡æ•°Spaceã‚’ä½œæˆã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„");
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", function () {
        log("ğŸš€ ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†");
        log("ğŸ’¡ Ctrl+Alt+Sã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPã‚’èµ·å‹•ã§ãã¾ã™");
      });

      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–
      document.addEventListener("keydown", function (event) {
        if (event.ctrlKey && event.altKey && event.key === "s") {
          log("ğŸ¹ ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³PiPã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒæŠ¼ã•ã‚Œã¾ã—ãŸ");
          event.preventDefault();
        }
      });
    </script>
  </body>
</html>
