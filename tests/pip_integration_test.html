<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>çµ±åˆPiPæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ - MyBrowser</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
      }
      .test-section {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
      }
      video {
        width: 100%;
        max-width: 500px;
        border-radius: 8px;
        margin: 10px 0;
      }
      button {
        padding: 12px 20px;
        margin: 8px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        opacity: 0.6;
        cursor: not-allowed;
      }
      #status {
        background: #000;
        color: #0f0;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        margin: 20px 0;
        min-height: 200px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
      .success {
        color: #28a745;
      }
      .error {
        color: #dc3545;
      }
      .info {
        color: #17a2b8;
      }
      .warning {
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ¥ Picture-in-Picture çµ±åˆãƒ†ã‚¹ãƒˆ</h1>

      <div class="test-section">
        <h2>ğŸ“º ãƒ†ã‚¹ãƒˆãƒ“ãƒ‡ã‚ª</h2>
        <video id="testVideo" controls preload="metadata">
          <!-- Sample videos for testing -->
          <source
            src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
            type="video/mp4"
          />
          <source
            src="https://www.w3schools.com/html/mov_bbb.mp4"
            type="video/mp4"
          />
          <source
            src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMWlzb20AAA=="
            type="video/mp4"
          />
          ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯HTML5ãƒ“ãƒ‡ã‚ªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
        </video>

        <div>
          <button onclick="playVideo()" id="playBtn">â–¶ï¸ å†ç”Ÿ</button>
          <button onclick="pauseVideo()" id="pauseBtn">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
          <button onclick="testPiPSupport()" id="supportBtn">
            ğŸ” PiP ã‚µãƒãƒ¼ãƒˆç¢ºèª
          </button>
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ›ï¸ Picture-in-Picture ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        <div>
          <button onclick="requestPiP()" id="pipBtn">ğŸ“º PiP é–‹å§‹</button>
          <button onclick="exitPiP()" id="exitBtn">âŒ PiP çµ‚äº†</button>
          <button onclick="testBrowserPiP()" id="browserBtn">
            ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶çµ±åˆãƒ†ã‚¹ãƒˆ
          </button>
          <button onclick="testShortcut()" id="shortcutBtn">
            âŒ¨ï¸ Ctrl+P ãƒ†ã‚¹ãƒˆ
          </button>
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="status">åˆæœŸåŒ–ä¸­...</div>
        <button onclick="clearStatus()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <script>
      const video = document.getElementById("testVideo");
      const status = document.getElementById("status");
      let logCount = 0;

      function log(message, type = "info") {
        logCount++;
        const timestamp = new Date().toLocaleTimeString();
        const className = type;
        status.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        status.scrollTop = status.scrollHeight;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      function clearStatus() {
        status.innerHTML = "";
        logCount = 0;
        log("ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
      }

      async function playVideo() {
        try {
          log("â–¶ï¸ ãƒ“ãƒ‡ã‚ªå†ç”Ÿã‚’é–‹å§‹ã—ã¾ã™...", "info");
          await video.play();
          log("âœ… ãƒ“ãƒ‡ã‚ªå†ç”Ÿé–‹å§‹æˆåŠŸ", "success");
        } catch (error) {
          log(`âŒ ãƒ“ãƒ‡ã‚ªå†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      function pauseVideo() {
        log("â¸ï¸ ãƒ“ãƒ‡ã‚ªã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™...", "info");
        video.pause();
        log("âœ… ãƒ“ãƒ‡ã‚ªä¸€æ™‚åœæ­¢å®Œäº†", "success");
      }

      function testPiPSupport() {
        log("=== PiP ã‚µãƒãƒ¼ãƒˆç¢ºèªé–‹å§‹ ===", "info");

        // åŸºæœ¬APIç¢ºèª
        const pipEnabled = "pictureInPictureEnabled" in document;
        log(
          `ğŸ“Œ document.pictureInPictureEnabled å­˜åœ¨: ${pipEnabled}`,
          pipEnabled ? "success" : "error"
        );

        if (pipEnabled) {
          log(
            `ğŸ“Œ document.pictureInPictureEnabled å€¤: ${document.pictureInPictureEnabled}`,
            document.pictureInPictureEnabled ? "success" : "warning"
          );
        }

        // ãƒ“ãƒ‡ã‚ªè¦ç´ ç¢ºèª
        const pipMethod = "requestPictureInPicture" in video;
        log(
          `ğŸ“Œ video.requestPictureInPicture å­˜åœ¨: ${pipMethod}`,
          pipMethod ? "success" : "error"
        );

        const disableProp = "disablePictureInPicture" in video;
        log(
          `ğŸ“Œ video.disablePictureInPicture å­˜åœ¨: ${disableProp}`,
          disableProp ? "success" : "error"
        );

        if (disableProp) {
          log(
            `ğŸ“Œ video.disablePictureInPicture å€¤: ${video.disablePictureInPicture}`,
            !video.disablePictureInPicture ? "success" : "warning"
          );
        }

        // ç¾åœ¨ã®PiPçŠ¶æ…‹
        const pipElement = "pictureInPictureElement" in document;
        log(
          `ğŸ“Œ document.pictureInPictureElement å­˜åœ¨: ${pipElement}`,
          pipElement ? "success" : "error"
        );

        if (pipElement) {
          log(
            `ğŸ“Œ ç¾åœ¨ã®PiPè¦ç´ : ${
              document.pictureInPictureElement ? "ã‚ã‚Š" : "ãªã—"
            }`,
            "info"
          );
        }

        // ãƒ“ãƒ‡ã‚ªçŠ¶æ…‹
        log(
          `ğŸ“Œ ãƒ“ãƒ‡ã‚ªçŠ¶æ…‹: paused=${
            video.paused
          }, currentTime=${video.currentTime.toFixed(2)}, duration=${
            video.duration || "N/A"
          }`,
          "info"
        );
        log(
          `ğŸ“Œ ãƒ“ãƒ‡ã‚ªæº–å‚™çŠ¶æ…‹: readyState=${video.readyState}, networkState=${video.networkState}`,
          "info"
        );

        log("=== PiP ã‚µãƒãƒ¼ãƒˆç¢ºèªå®Œäº† ===", "info");
      }

      async function requestPiP() {
        log("=== PiP é–‹å§‹è©¦è¡Œ ===", "info");

        try {
          // ã¾ãšå†ç”Ÿé–‹å§‹
          if (video.paused) {
            log("ğŸ¬ ãƒ“ãƒ‡ã‚ªã‚’å†ç”Ÿé–‹å§‹...", "info");
            await video.play();
          }

          log("ğŸ“º PiP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­...", "info");
          const pipWindow = await video.requestPictureInPicture();
          log(
            `âœ… PiP é–‹å§‹æˆåŠŸï¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º: ${pipWindow.width}x${pipWindow.height}`,
            "success"
          );

          pipWindow.addEventListener("resize", () => {
            log(
              `ğŸ“ PiPã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚º: ${pipWindow.width}x${pipWindow.height}`,
              "info"
            );
          });
        } catch (error) {
          log(`âŒ PiP é–‹å§‹å¤±æ•—: ${error.name} - ${error.message}`, "error");

          switch (error.name) {
            case "NotSupportedError":
              log("ğŸ’¡ ã“ã®ç’°å¢ƒ/ãƒ“ãƒ‡ã‚ªã¯PiPã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“", "warning");
              break;
            case "NotAllowedError":
              log(
                "ğŸ’¡ PiPä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ï¼‰",
                "warning"
              );
              break;
            case "InvalidStateError":
              log("ğŸ’¡ ãƒ“ãƒ‡ã‚ªã®çŠ¶æ…‹ãŒç„¡åŠ¹ã§ã™ï¼ˆå†ç”ŸãŒå¿…è¦ï¼‰", "warning");
              break;
            default:
              log(`ğŸ’¡ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${error.name}`, "warning");
          }
        }
      }

      async function exitPiP() {
        log("=== PiP çµ‚äº†è©¦è¡Œ ===", "info");

        try {
          if (document.pictureInPictureElement) {
            await document.exitPictureInPicture();
            log("âœ… PiP çµ‚äº†æˆåŠŸ", "success");
          } else {
            log("â„¹ï¸ ç¾åœ¨PiPãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“", "warning");
          }
        } catch (error) {
          log(`âŒ PiP çµ‚äº†å¤±æ•—: ${error.name} - ${error.message}`, "error");
        }
      }

      function testBrowserPiP() {
        log("=== ãƒ–ãƒ©ã‚¦ã‚¶çµ±åˆPiPæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ ===", "info");
        log(
          "ğŸ’¡ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã€Œè¡¨ç¤ºã€â†’ã€ŒPicture-in-Pictureã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„",
          "info"
        );
        log("ğŸ’¡ ã¾ãŸã¯å³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠè©¦ã—ãã ã•ã„", "info");

        // ãƒ“ãƒ‡ã‚ªè¦ç´ ã®çŠ¶æ…‹ã‚’è©³ã—ãç¢ºèª
        const attrs = [];
        for (let attr of video.attributes) {
          attrs.push(`${attr.name}="${attr.value}"`);
        }
        log(`ğŸ“‹ ãƒ“ãƒ‡ã‚ªè¦ç´ å±æ€§: ${attrs.join(", ")}`, "info");
      }

      function testShortcut() {
        log("=== Ctrl+P ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ===", "info");
        log(
          "ğŸ’¡ Ctrl+P (macOSã§ã¯ Cmd+P) ã‚’æŠ¼ã—ã¦PiPã‚’é–‹å§‹ã—ã¦ãã ã•ã„",
          "info"
        );
        log("ğŸ’¡ ã“ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™", "info");
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      document.addEventListener("enterpictureinpicture", (event) => {
        log("ğŸ‰ PiPé–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼", "success");
        log(`ğŸ“º PiPè¦ç´ : ${event.target.tagName}`, "info");
      });

      document.addEventListener("leavepictureinpicture", (event) => {
        log("ğŸ‘‹ PiPçµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ", "info");
        log(`ğŸ“º çµ‚äº†ã—ãŸè¦ç´ : ${event.target.tagName}`, "info");
      });

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
      window.addEventListener("load", () => {
        log("ğŸš€ PiPçµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ", "success");
        log("ğŸ” PiPã‚µãƒãƒ¼ãƒˆã®è‡ªå‹•ç¢ºèªã‚’é–‹å§‹ã—ã¾ã™...", "info");

        setTimeout(() => {
          testPiPSupport();
        }, 1000);
      });

      // ãƒ“ãƒ‡ã‚ªé–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆ
      video.addEventListener("loadedmetadata", () => {
        log("ğŸ¬ ãƒ“ãƒ‡ã‚ªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†", "success");
      });

      video.addEventListener("canplay", () => {
        log("â–¶ï¸ ãƒ“ãƒ‡ã‚ªå†ç”Ÿæº–å‚™å®Œäº†", "success");
      });

      video.addEventListener("error", (e) => {
        log(`âŒ ãƒ“ãƒ‡ã‚ªã‚¨ãƒ©ãƒ¼: ${e.message || "unknown error"}`, "error");
      });
    </script>
  </body>
</html>
